# Verifies changes to the brand plugin testing workflow.
name: Verify Module Plugin Testing

on:
  push:
    branches:
      - main
      - develop
    paths:
      - '**.yml'
  pull_request:
    types: [ opened, edited, synchronize, reopened, ready_for_review ]
    paths:
      - '**.yml'

concurrency:
  group: ${{ github.workflow }}-${{ github.event_name == 'pull_request' && github.head_ref || github.sha }}
  cancel-in-progress: true

# Disable permissions for all available scopes by default.
# Any needed permissions should be configured individually for each job.
permissions: {}

jobs:
  verify-module-plugin-test:
    name: ${{ matrix.name }} on PHP ${{ matrix.php-version }} / ${{ matrix.module }}
    strategy:
      fail-fast: false
      matrix:
        brand: [ 'bluehost', 'crazydomains', 'hostgator', 'mojo', 'web.com' ]
        module: [ 'wp-module-activation', 'wp-module-onboarding', 'wp-module-data', 'wp-module-patterns', 'wp-module-performance' ]
        php-version: [ '7.4', '8.2' ]

        include:
          - brand: 'bluehost'
            name: 'Bluehost'
            plugin-repo: 'newfold-labs/wp-plugin-bluehost'
          - brand: 'crazydomains'
            name: 'Crazy Domains'
            plugin-repo: 'newfold-labs/wp-plugin-crazy-domains'
          - brand: 'hostgator'
            name: 'HostGator'
            plugin-repo: 'newfold-labs/wp-plugin-hostgator'
          - brand: 'mojo'
            name: 'Mojo'
            plugin-repo: 'newfold-labs/wp-plugin-mojo'
          - brand: 'web.com'
            name: 'Web.com'
            plugin-repo: 'newfold-labs/wp-plugin-web'

          # Include one job for each brand plugin that runs all tests.
          - brand: 'bluehost'
            name: 'Bluehost'
            plugin-repo: 'newfold-labs/wp-plugin-bluehost'
            module: 'wp-module-secure-passwords'

          - brand: 'crazydomains'
            name: 'Crazy Domains'
            plugin-repo: 'newfold-labs/wp-plugin-crazy-domains'
            module: 'wp-module-ai'

          - brand: 'hostgator'
            name: 'HostGator'
            plugin-repo: 'newfold-labs/wp-plugin-hostgator'
            module: 'wp-module-onboarding'

          - brand: 'mojo'
            name: 'Mojo'
            plugin-repo: 'newfold-labs/wp-plugin-mojo'
            module: 'wp-module-secure-passwords'

          - brand: 'web.com'
            name: 'Web.com'
            plugin-repo: 'newfold-labs/wp-plugin-web'
            module: 'wp-module-coming-soon'

    uses: ./.github/workflows/module-plugin-test.yml
    with:
      php-version: ${{ matrix.php-version }}
      plugin-repo: ${{ matrix.plugin-repo }}
      module-repo: newfold-labs/${{ matrix.module }}
      module-branch: 'main'
      node-version: '20'
      only-module-tests: true
      artifact-name: ${{ matrix.module }}
